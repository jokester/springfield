{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"React\"","webpack:///external \"ReactDOM\"","webpack:///./src/lib/delegate.ts","webpack:///./src/lib/positional/positional-snapshots.ts","webpack:///./src/lib/positional/positional-transition.ts","webpack:///./src/lib/default-delegate.ts","webpack:///./src/lib/shared-elem.tsx","webpack:///./demo/share-elem-lib-demo.tsx","webpack:///./demo/index.tsx"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","React","ReactDOM","TransitionPhase","SpringfieldContext","createPositionSnapshot","elem","timestamp","Date","now","left","right","top","bottom","getBoundingClientRect","width","height","centerOf","pos","x","y","globalSnapshotStorage","Map","defaultSpringfieldDelegate","takeSnapshot","logicalId","instanceId","storage","innerMap","set","takePositionalSnapshot","removeSnapshot","inner","delete","size","removePositionalSnapshot","phase","transition","window","initialRender","opacity","beforeTransition","lastSnapshot","pId","snapshot","entries","findPositionalSnapshot","last","first","centerFirst","centerLast","transform","join","computeInvertedPositionalTransition","duringTransition","afterTransition","SharedElement","children","isTarget","ref","delegate","extraStyle","setExtraStyle","createStyle","undefined","current","HTMLElement","effecting","invertedTransform","requestAnimationFrame","tidyUp","removeEventListener","addEventListener","length","origElem","componentClasses","button","verticalContainer","tabHeader","userIcon","tabContent","mainContent","userAvatar","ShareElemLibPlayground","props","currentTab","setCurrentTab","className","title","onClick","style","_1","_2","console","log","render","document","getElementById"],"mappings":"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","file":"main.1b80c83c.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = React;","module.exports = ReactDOM;","/**\n * @file delegate.ts\n * extension point of this library\n * - what elements to apply transition\n * - what transition / transform to apply\n */\nimport * as React from 'react';\n\n/**\n * @see https://aerotwist.com/blog/flip-your-animations/ for explanations of \"first\" \"last\" \"inverted\"\n */\nexport enum TransitionPhase {\n  /**\n   * the styles to render a DOM element and measure its \"stable\" state\n   * e.g. {@code { opacity: 0 }}\n   * @note returning `undefined` would apply no transition.\n   * @note implementations should return undefined in SSR\n   */\n  initialRender = 0,\n\n  /**\n   * the styles to apply before transition starts\n   * e.g. \"inverted\" transform styles that transforms the position measured at `initialRender` to\n   * the last snapshot of the logical element (\"first\")\n   * @note returning `undefined` would apply no transition\n   */\n  beforeTransition = 1,\n\n  /**\n   * the styles that starts (and exists during) transition\n   * e.g. no transform (to undo transform done by `beforeTransition`) and CSS `transition` property.\n   */\n  duringTransition = 2,\n\n  /**\n   * the styles to apply after transition ends\n   * e.g. empty (so that the element gets rendered normally)\n   */\n  afterTransition = 3,\n}\n\nexport interface SpringfieldDelegate {\n  takeSnapshot(logicalId: string, instanceId: string, elem: HTMLElement): void;\n  removeSnapshot(logicalId: string, instanceId: string): void;\n\n  /**\n   *\n   * @param phase\n   * @param logicalId\n   * @param instanceId\n   * @param elem\n   * @param transition property specified in {@ref SharedElement}\n   * @return inline styles to render DOM element with\n   */\n  createStyle(\n    phase: TransitionPhase,\n    logicalId: string,\n    instanceId: string,\n    elem: undefined | HTMLElement,\n    transition?: string,\n  ): undefined | /* React.CSSProperties */ {};\n}\n\nexport const SpringfieldContext = React.createContext<null | SpringfieldDelegate>(null);\n","export type PositionSnapshot = (ClientRect | DOMRect) & {\n  timestamp: number;\n};\n\nexport function createPositionSnapshot(elem: HTMLElement): PositionSnapshot {\n  const timestamp = Date.now();\n  const { left, right, top, bottom } = elem.getBoundingClientRect();\n  return {\n    timestamp,\n    left,\n    right,\n    top,\n    bottom,\n    width: right - left,\n    height: bottom - top,\n  };\n}\n\nexport declare type PositionalSnapshotStorage = Map<\n  /* logicalId */ string,\n  Map</* instanceId */ string, PositionSnapshot>\n>;\n\nexport function takePositionalSnapshot(\n  storage: PositionalSnapshotStorage,\n  logicalId: string,\n  instanceId: string,\n  elem: HTMLElement,\n): void {\n  const x = createPositionSnapshot(elem);\n  if (!(x.width && x.height)) return;\n\n  const innerMap = storage.get(logicalId);\n  if (innerMap) {\n    innerMap.set(instanceId, x);\n  } else {\n    storage.set(logicalId, new Map([[instanceId, x]]));\n  }\n}\n\nexport function findPositionalSnapshot(\n  storage: PositionalSnapshotStorage,\n  logicalId: string,\n  instanceId: string,\n): null | PositionSnapshot {\n  let inner;\n  if ((inner = storage.get(logicalId))) {\n    for (const [pId, snapshot] of inner.entries()) {\n      if (pId !== instanceId && snapshot) return snapshot;\n    }\n  }\n  return null;\n}\n\nexport function removePositionalSnapshot(\n  storage: PositionalSnapshotStorage,\n  logicalId: string,\n  instanceId: string,\n): void {\n  let inner;\n  if ((inner = storage.get(logicalId))) {\n    inner.delete(instanceId);\n    if (!inner.size) {\n      storage.delete(logicalId);\n    }\n  }\n}\n","import { PositionSnapshot } from './positional-snapshots';\n\nfunction centerOf(pos: PositionSnapshot) {\n  return { x: pos.left + pos.width / 2, y: pos.top + pos.height / 2 };\n}\n\n/**\n * @param last\n * @param first\n * @returns inline styles that make 'last' appear at position of 'first'\n */\nexport function computeInvertedPositionalTransition(\n  last: PositionSnapshot,\n  first: PositionSnapshot,\n): /* React.CSSProperties */ {} {\n  const centerFirst = centerOf(first);\n  const centerLast = centerOf(last);\n\n  return {\n    transform: [\n      `translateX(${centerFirst.x - centerLast.x}px)`,\n      `translateY(${centerFirst.y - centerLast.y}px)`,\n      `scaleX(${first.width / last.width})`,\n      `scaleY(${first.height / last.height})`,\n    ].join(' '),\n  };\n}\n","import {\n  createPositionSnapshot,\n  findPositionalSnapshot,\n  PositionalSnapshotStorage,\n  removePositionalSnapshot,\n  takePositionalSnapshot,\n} from './positional/positional-snapshots';\nimport { SpringfieldDelegate, TransitionPhase } from './delegate';\nimport { computeInvertedPositionalTransition } from './positional/positional-transition';\n\nconst globalSnapshotStorage: PositionalSnapshotStorage = new Map();\n\n/**\n * A global singleton\n */\nexport const defaultSpringfieldDelegate: SpringfieldDelegate = {\n  takeSnapshot(logicalId: string, instanceId: string, elem: HTMLElement) {\n    return takePositionalSnapshot(globalSnapshotStorage, logicalId, instanceId, elem);\n  },\n\n  removeSnapshot(logicalId: string, instanceId: string): void {\n    return removePositionalSnapshot(globalSnapshotStorage, logicalId, instanceId);\n  },\n\n  createStyle(\n    phase: TransitionPhase,\n    logicalId: string,\n    instanceId: string,\n    elem: undefined | HTMLElement,\n    transition = 'all 0.3s ease-in',\n  ): undefined | {} {\n    if (/* SSR */ typeof window === 'undefined') {\n      return undefined;\n    } else if (phase === TransitionPhase.initialRender) {\n      return { opacity: 0 };\n    } else if (phase === TransitionPhase.beforeTransition && elem) {\n      const lastSnapshot = findPositionalSnapshot(globalSnapshotStorage, logicalId, instanceId);\n      if (lastSnapshot) {\n        const current = createPositionSnapshot(elem);\n        return computeInvertedPositionalTransition(current, lastSnapshot);\n      }\n    } else if (phase === TransitionPhase.duringTransition) {\n      return { transition };\n    } else if (phase === TransitionPhase.afterTransition) {\n      return undefined;\n    }\n    return undefined;\n  },\n};\n","import React, { cloneElement, useCallback, useContext, useLayoutEffect, useRef, useState } from 'react';\nimport { SpringfieldContext, TransitionPhase } from './delegate';\nimport { defaultSpringfieldDelegate } from './default-delegate';\n\ninterface SharedElemProps {\n  /**\n   * @param extraStyle\n   * inline styles to render a DOM element with. Typically contains opacity / transform / transition\n   *\n   * @param takeSnapshot\n   * a callback to take snapshot manually. e.g. in scroll/click event handler\n   *\n   * @param removeSnapshot\n   * a callback to remove snapshot manually. e.g. when the element is no longer appropriate a transition source\n   *\n   * @param ref If the desired shared element is not return value of children, manually pass to desired element.\n   */\n  children(\n    extraStyle: undefined | React.CSSProperties,\n    takeSnapshot: () => void,\n    removeSnapshot: () => void,\n    ref?: React.MutableRefObject<any>,\n  ): React.ReactElement;\n\n  /**\n   * identifier of a logical element\n   * @example \"user-avatar\"\n   */\n  logicalId: string;\n\n  /**\n   * identifier of a occurrence of a \"logical element\"\n   * @example \"in-toolbar\" \"in-profile-component\"\n   */\n  instanceId: string;\n\n  /**\n   * transition spec when corresponded DOM element is mounted\n   * @default '0.3s all ease-in'\n   * @see https://developer.mozilla.org/en-US/docs/Web/CSS/transition\n   */\n  transition?: string;\n\n  /**\n   * apply transition after children is rendered\n   * @default false\n   * (all SharedElement-rendered children are source of transitions)\n   */\n  isTarget?: boolean;\n}\n\nexport const SharedElement: React.FC<SharedElemProps> = ({ children, instanceId, isTarget, logicalId, transition }) => {\n  const ref = useRef<HTMLElement>(null!);\n  const delegate = useContext(SpringfieldContext) || defaultSpringfieldDelegate;\n\n  const [extraStyle, setExtraStyle] = useState<undefined | React.CSSProperties>(() =>\n    isTarget\n      ? delegate.createStyle(TransitionPhase.initialRender, logicalId, instanceId, undefined, transition)\n      : undefined,\n  );\n\n  const takeSnapshot = useCallback(() => {\n    if (ref.current instanceof HTMLElement && logicalId && instanceId)\n      delegate.takeSnapshot(logicalId, instanceId, ref.current);\n  }, [logicalId, instanceId, delegate]);\n\n  const removeSnapshot = useCallback(() => {\n    if (logicalId && instanceId) delegate.removeSnapshot(logicalId, instanceId);\n  }, [instanceId, logicalId, delegate]);\n\n  useLayoutEffect(() => {\n    const elem = ref.current;\n    if (!(elem instanceof HTMLElement)) return;\n\n    takeSnapshot();\n\n    let effecting = true;\n\n    if (isTarget && logicalId && instanceId && extraStyle /* the value for initialRender */) {\n      const invertedTransform = delegate.createStyle(\n        TransitionPhase.beforeTransition,\n        logicalId,\n        instanceId,\n        ref.current,\n        transition,\n      );\n\n      setExtraStyle(invertedTransform || undefined);\n      // do not start transition if invertedTransform is falsy (and we just unset the styles)\n      if (!invertedTransform) return;\n\n      /**\n       * requestAnimationFrame does not really ensure `invertedTransform` style is set to DOM\n       * If this becomes a problem, consider https://www.robinwieruch.de/react-usestate-callback\n       */\n      requestAnimationFrame(() => {\n        if (!(effecting && ref.current === elem)) return;\n\n        // force invertedTransform to be layouted\n        elem.getBoundingClientRect();\n\n        setExtraStyle(delegate.createStyle(TransitionPhase.duringTransition, logicalId, instanceId, elem, transition));\n\n        const tidyUp = () => {\n          elem.removeEventListener('transitionend', tidyUp);\n          if (!(effecting && ref.current === elem)) return;\n\n          setExtraStyle(delegate.createStyle(TransitionPhase.afterTransition, logicalId, instanceId, elem, transition));\n        };\n        elem.addEventListener('transitionend', tidyUp);\n      });\n    }\n\n    return () => {\n      effecting = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isTarget, logicalId, instanceId, transition, takeSnapshot, delegate /* NO extraStyle */]);\n\n  if (typeof children !== 'function') {\n    /**\n     * when api mismatch: silently do nothing\n     */\n    return children as React.ReactElement;\n  } else if (children.length > 3) {\n    /**\n     * when children (a function) makes use of ref: do not inject own\n     */\n    return children(extraStyle, takeSnapshot, removeSnapshot, ref) as React.ReactElement;\n  } else {\n    /**\n     * assume it renders to a DOM element, and inject our ref\n     */\n    const origElem = children(extraStyle, takeSnapshot, removeSnapshot);\n    return cloneElement(origElem, { ref }) as React.ReactElement;\n  }\n};\n","import React, { useState } from 'react';\nimport { SharedElement } from '../src/lib/shared-elem';\n\nconst componentClasses = {\n  button: `p-2 inline-block border border-solid shadow-outline focus:outline-0`,\n  verticalContainer: `flex p-4 justify-around`,\n  tabHeader: `flex items-center justify-end p-4 `,\n  userIcon: `flex-none inline-block w-24 h-24 border-solid border bg-gray-200`,\n  tabContent: `h-64`,\n  mainContent: 'h-64 bg-gray-100',\n  userAvatar: 'w-40 h-40 border-solid border inline-block bg-gray-200 mx-4',\n} as const;\n\nexport const ShareElemLibPlayground: React.FC = props => {\n  const [currentTab, setCurrentTab] = useState<1 | 2 | 3>(1);\n  return (\n    <div>\n      <p className={componentClasses.verticalContainer}>\n        <button title=\"tab1\" className={componentClasses.button} onClick={() => setCurrentTab(1)}>\n          tab1\n        </button>\n        <button title=\"tab2\" className={componentClasses.button} onClick={() => setCurrentTab(2)}>\n          tab2\n        </button>\n      </p>\n\n      {currentTab === 1 && (\n        <div>\n          <div className={componentClasses.tabContent}>\n            <SharedElement logicalId=\"user\" instanceId=\"tab\" isTarget transition=\"all 2s linear\">\n              {(style, _1, _2, ref) => {\n                console.log('user/tab', style);\n                return <div className={componentClasses.userIcon} ref={ref} style={style} />;\n              }}\n            </SharedElement>\n          </div>\n          <div className={componentClasses.mainContent}>\n            <p>page1</p>\n          </div>\n        </div>\n      )}\n      {currentTab === 2 && (\n        <div>\n          <div className={componentClasses.tabContent}>{/*<div className={componentClasses.userIcon} />*/}</div>\n          <div className={componentClasses.mainContent}>\n            <p>page2</p>\n            <SharedElement logicalId=\"user\" instanceId=\"main\" isTarget>\n              {(style, takeSnapshot) => {\n                console.log('user/main', style);\n                return (\n                  <div\n                    className={componentClasses.userAvatar}\n                    style={style}\n                    onClick={() => {\n                      takeSnapshot();\n                      setCurrentTab(1);\n                    }}\n                  />\n                );\n              }}\n            </SharedElement>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { ShareElemLibPlayground } from './share-elem-lib-demo';\n\nfunction registerHMR() {\n  type ModuleHMR = typeof module & {\n    hot?: {\n      accept(dependencies: string | string[], callback: (updatedDependencies: any[]) => void): void;\n      accept(callback: (updatedDependencies: any[]) => void): void;\n    };\n  };\n\n  if ((module as ModuleHMR).hot) {\n    (module as ModuleHMR).hot!.accept(render);\n  }\n}\n\nfunction render() {\n  ReactDOM.render(\n    <>\n      <ShareElemLibPlayground />\n    </>,\n    document.getElementById('root') as HTMLElement,\n  );\n}\n\nregisterHMR();\nrender();\n"],"sourceRoot":""}